stages:
  - test-integration

test:
  stage: test-integration
  image: openjdk:17.0.2-slim-buster
  variables:
    DOCKER_HOST: tcp://docker:2375
    DOCKER_TLS_CERTDIR: ""
    DOCKER_DRIVER: overlay2
  services:
    - docker:19.03.13-dind
  script:
    - apt-get update && apt-get install -y git docker docker-compose curl
    - docker network create test-network
    - >
      docker run --name claims-form-test --network test-network --mount type=bind,source=$(pwd),target="/claims"
      --entrypoint /bin/bash openjdk:17.0.2-slim-buster
      -c "cd claims && ./install.sh && cd cucumber && ls -la && ./gradlew cucumber -Denv=headless"
